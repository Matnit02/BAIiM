<!-- jquery datatable CSS -->
<style>
    <?php
    require_once $_SERVER['DOCUMENT_ROOT'] . '/biblio/jquery.dataTables.min.css';
    ?>
</style>

<!-- jquery datatable JS -->
<script>
    <?php
    require_once $_SERVER['DOCUMENT_ROOT'] . '/biblio/jquery.dataTables.min.js';
    ?>
</script>

<!-- jquery datatable home CSS -->
<style>
    .box {
        padding: 1rem;
        font-family: Helvetica;
        margin: 2rem;
        text-align: center;
        background-color: #FFCCFF;
    }

    .showHideColumn {
        cursor: pointer;
        user-select: none;
        font-weight: bold;
    }

    .search {
        margin: 0;
        height: auto;
        width: auto;
        display: block;
        min-width: 100%;
        padding: 6px 12px;
        font-size: 14px;
        line-height: 1.42857143;
        font-weight: normal;
        border: 1px solid #ccc;
        background-color: #FF9999;
    }

    .big-checkbox {
        width: 35px;
        height: 35px;
        padding: 18px;
    }

    .panel-heading {
        padding: 10px 15px;

        border: 1px solid transparent;
        border-bottom-color: transparent;
        border-top-left-radius: 3px;
        border-top-right-radius: 3px;
    }

    .panel-default>.panel-heading {
        color: #333;
        background-color: #FF9999;
        border-color: #ddd;
    }

    .panel-body {
        padding: 15px;
    }
</styLe>


<?php
require_once $table;
?>

<!-- datatable init -->
<script>
    $(function() {
        $('#content_table tfoot th').each(function() {
            var title = $(this).text();
            if (title[0] == '*') {
                $(this).html('<input type="text" class="search" placeholder="Search ' + title.replace('*', '') + '" />');
            } else if (title[0] == '~') {
                $(this).html('');
            } else {
                $(this).html('');
            }
        });

        tiltes = [{
                'name': 'Verify',
                'title': 'Verify certificates uploaded by given user',
            },
            {
                'name': 'Employee ID',
                'title': 'Employee ID',
            },
            {
                'name': 'Review type',
                'title': `Type of request:
                        request - the user has submitted a new request
                        cert_check - the user has uploaded valid certificates`,
            },
            {
                'name': 'Name',
                'title': 'Full name',
            },
            {
                'name': 'login',
                'title': 'Unique login',
            },
            {
                'name': 'Email',
                'title': 'Email address',
            },
            {
                'name': 'Comments',
                'title': `Information generated by the system or overwritten by labadmin with the \'w\' right about the user.
                        \"User auto-add\" - user added automatically by system
                        \"User manual-add\" - user added manualy
                        \"User request-add\" - user added by other user through request`
            },
            {
                'name': 'Manager',
                'title': `Manager's e-mail address`,
            },
            {
                'name': 'Delegated manager',
                'title': `A delegated manager to perform the function of the user's manager`,
            },
            {
                'name': 'Request/Activation date',
                'title': 'Date of activation of access to laboratories',
            },
            {
                'name': 'Manager comments',
                'title': 'Comment left by the manager',
            },
            {
                'name': 'Admin comments',
                'title': 'Comment left by the lab administrator',
            },
            {
                'name': 'training1 date',
                'title': 'Date of completion of the training1',
            },
            {
                'name': 'training2 date',
                'title': 'Date of completion of the ESA training2',
            },
            {
                'name': 'BID',
                'title': 'Four-digit BID',
            },
            {
                'name': 'BSID',
                'title': 'Five-digit BSID',
            },
            {
                'name': 'Edit inline',
                'title': 'Click to edit this record in line',
            },
            {
                'name': 'Delete request',
                'title': 'Deletion of the record',
            },
            {
                'name': 'Delete user',
                'title': 'Deletion of the user',
            },
            {
                'name': 'Manager ID',
                'title': `NSN ID of the user's manager`,
            },
            {
                'name': 'Delegated manager ID',
                'title': `NSN ID of the delegated manager`,
            },
            {
                'name': 'status1',
                'title': 'Information about the status of the completion of the training1',
            },
            {
                'name': 'status2',
                'title': 'Information about the status of the completion of the training2',
            },
            {
                'name': 'Rights',
                'title': `User rights:
                            w (write) - user can change the data of this table 
                            l (labadmin) - the user has labadmin rights (access to 'labadmin review' tab)
                            m (manager) - user has manager rights (access to 'lm review' tab)
                            g (access everywhere) - user can access other people account`,
            },
            {
                'name': 'Request status',
                'title': `
                        -	Status 0 - no request saved
                        -	Status 1 - request saved
                        -	Status 2 - request send to manager
                        -	
                        -	Status 3 - request block by manager (user can't edit request)
                        -	Status 4 - request deny by manager (user can edit request)
                        -	Status 5 - request accepted by manager, request send to admin team

                        -	Status 6 - request block by admin team (user can't edit request)
                        -	Status 7 - request deny by admin team (user can edit request)
                        -	Status 8 - request accepted by admin team (after 2.5yrs you can renew your training)`,
            },
            {
                'name': 'Active status',
                'title': `
                        -   Status 0 - user request not completed
                        -   Status 1 - user can access rooms/buildings
                        -   Status 2 - users certificates is beeing check by admin team
                        -   Status 3 - labteam deny certificates
                        -   Status 4 - access to rooms/buildings revoked`,
            },
            {
                'name': 'Request data',
                'title': 'Date on which the request was sent'
            },
            {
                'name': 'Revoke access',
                'title': 'Removal of rights - the user will be informed that you have withdrawn his rights to access',
            },
            {
                'name': 'Expiration date',
                'title': 'Expiry date of completed training',
            },
            {
                'name': 'Activaiton date',
                'title': 'Date the access request was accepted',
            },
            {
                'name': 'Time to reupload certificate',
                'title': 'After this date access right will be revoked',
            },
            {
                'name': 'Check',
                'title': 'Checkbox',
            },
            {
                'name': 'Delegated to you',
                'title': 'Information whether a given user is delegated to you',
            },
            {
                'name': 'Delegated by',
                'title': 'Information who delegated the user to you',
            },
            {
                'name': 'Delegated by you',
                'title': 'Information whether you delegated given user',
            },
            {
                'name': 'Delegated to',
                'title': 'Information to whom you delegated a given user',
            },
            {
                'name': 'Lock/Unlock request',
                'title': 'You can block and unblock a user from sending requests.',
            },
        ];

        var datatableInstance = $('#content_table').DataTable({
            initComplete: function() {
                // Apply the search
                var api = this.api();
                api.$('td').click(function(e) {
                    if (e.shiftKey) {
                        api.search($(this).text()).draw();
                    }
                });

                api
                    .columns()
                    .every(function() {
                        var column = this;

                        $('input', this.footer()).on('keyup change clear', function() {
                            if (column.search() !== this.value) {
                                column.search(this.value).draw();
                            }
                        });
                    });
            },
            <?php if (isset($sortCallBack)) : ?> "fnDrawCallback": function() {
                    $('#content_table tbody tr').each(function() {
                        let button = $(this).children().eq(0).children();
                        if (button.attr('data-toggle') == 'open') {
                            button.html('<span class="material-icons">edit</span>');
                            button.attr('data-toggle', 'close');
                            alertBox('Inline editing aborted! The process has stopped.')
                        }
                    });
                },
            <?php endif ?> 'paging': true,
            'sort': true,
            'searching': true,
            'proccesing': true,
            'lengthChange': true,
            'searching': true,
            'ordering': true,
            'info': true,
            'autoWidth': true,
            'pageLength': 200,
            'aLengthMenu': [
                [25, 50, 100, 200, -1],
                [25, 50, 100, 200, "All"]
            ],
            'aaSorting': [11, 'desc'],
            ajax: {
                url: './review/fetch',
                type: "POST"
            },
            columns: columnsInfo,
            columnDefs: mycoldef,
            orderCellsTop: true,
            fixedHeader: true,
        });

        let value = 0;
        $("#content_table thead th").each(function() {
            if (!$('#content_table thead th:eq(' + value + ')').hasClass('button')) {
                if (value) {
                    $('#showHideIndicators').append(' <a class="showHideColumn" style="color: blue;" data-columnindex="' + value + '" >' + $(this).text() + '</a> <b> - </b>');
                } else {
                    $('#showHideIndicators').append('<a class="showHideColumn" style="color: blue;" data-columnindex="' + value + '" >' + $(this).text() + '</a> <b> - </b>');
                }
            }

            value += 1;

            let column = $(this);
            tiltes.forEach(function(t) {
                if ($(column).html() == t['name']) {
                    $(column).attr("title", t['title']);
                    return 0
                }
            })
        });


        $('.showHideColumn').click(function(e) {
            e.preventDefault();
            if ($(this)[0].style.color == 'gray') {
                $(this)[0].style.color = 'blue'
            } else {
                $(this)[0].style.color = 'gray';
            }
            var tableColumn = datatableInstance.column($(this).attr('data-columnindex'));
            tableColumn.visible(!tableColumn.visible());
        });
    });
</script>